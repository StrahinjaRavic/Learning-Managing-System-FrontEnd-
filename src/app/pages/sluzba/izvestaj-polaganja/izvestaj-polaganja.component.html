<h2>Izveštaj o polaganju ispita</h2>

<form [formGroup]="form" class="toolbar">
  <mat-form-field appearance="fill">
    <mat-label>Rok</mat-label>
    <mat-select formControlName="rokId">
      <mat-option *ngFor="let rok of rokovi" [value]="rok.id">{{ rok.naziv }}</mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="fill">
    <mat-label>Realizacija predmeta</mat-label>
    <mat-select formControlName="realizacijaPredmetaId">
      <mat-option *ngFor="let r of realizacije" [value]="r.id">
        {{ r.predmet.naziv }} – {{ r.godinaStudija.godina }}
      </mat-option>
    </mat-select>
  </mat-form-field>

  <button mat-raised-button color="primary" type="button" (click)="load()">Učitaj izveštaj</button>
  <button mat-raised-button color="accent" type="button" (click)="downloadPdf()">Preuzmi PDF</button>
  <button mat-raised-button color="warn" type="button" (click)="sendMail()">Pošalji mejl nastavnicima</button>
</form>

<div class="chartWrap">
  <canvas #histCanvas></canvas>
</div>

<div *ngIf="data as d">
  <div class="meta">
    <div><strong>Rok:</strong> {{ d.rokNaziv }} (ID: {{ d.rokId }})</div>
    <div><strong>Realizacija predmeta:</strong> {{ d.predmetNaziv }} (ID: {{ d.realizacijaPredmetaId }})</div>
    <div class="aggs">
      <span><strong>Broj prijava:</strong> {{ d.brojPrijava }}</span>
      <span><strong>Prosek bodova:</strong> {{ d.prosekBodova || '-' }}</span>
      <span><strong>Min:</strong> {{ d.minBodovi || '-' }}</span>
      <span><strong>Max:</strong> {{ d.maxBodovi || '-' }}</span>
    </div>
  </div>

  <table mat-table [dataSource]="d.rezultati" class="mat-elevation-z2">
    <ng-container matColumnDef="polaganjeId">
      <th mat-header-cell *matHeaderCellDef> Polaganje </th>
      <td mat-cell *matCellDef="let r">{{ r.polaganjeId }}</td>
    </ng-container>

    <ng-container matColumnDef="datum">
      <th mat-header-cell *matHeaderCellDef> Datum </th>
      <td mat-cell *matCellDef="let r">{{ r.datum | date:'dd.MM.yyyy.' }}</td>
    </ng-container>

    <ng-container matColumnDef="student">
      <th mat-header-cell *matHeaderCellDef> Student </th>
      <td mat-cell *matCellDef="let r">{{ r.student }}</td>
    </ng-container>

    <ng-container matColumnDef="indeks">
      <th mat-header-cell *matHeaderCellDef> Indeks </th>
      <td mat-cell *matCellDef="let r">{{ r.indeks }}</td>
    </ng-container>

    <ng-container matColumnDef="bodovi">
      <th mat-header-cell *matHeaderCellDef> Bodovi </th>
      <td mat-cell *matCellDef="let r">{{ r.bodovi ?? '-' }}</td>
    </ng-container>

    <ng-container matColumnDef="ocena">
      <th mat-header-cell *matHeaderCellDef> Ocena </th>
      <td mat-cell *matCellDef="let r">{{ r.ocena }}</td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>
</div>
